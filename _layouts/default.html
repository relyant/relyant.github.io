<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.title | default: "Sailing Kiruna" }}</title>
    <link rel="icon" type="image/png" href="{{ site.baseurl }}/logo.png">
    
    <!-- OPTIMIZATION: Preconnect to Google Fonts for faster loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        :root {
            --primary-color: #2196F3;
            --background-color: #0f0f0f;
            --surface-color: rgba(30, 30, 30, 0.6); 
            --text-primary: #FFFFFF;
            --text-secondary: #B3B3B3;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);

            /* Logo color palette */
            --logo-1: #4b3c6d; --logo-2: #068ab8; --logo-3: #046886;
            --logo-4: #a5c048; --logo-5: #f77102; --logo-6: #cb1025;
        }

        [data-theme="light"] {
            --background-color: #87CEEB;
            --surface-color: rgba(255, 255, 255, 0.65);
            --text-primary: #212121;
            --text-secondary: #424242;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background: var(--background-color);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease; /* OPTIMIZATION: Specific transitions are lighter than 'all' */
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        /* --- BACKGROUNDS --- */
        .stars-container, .lines-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        
        /* OPTIMIZATION: Reduce star complexity */
        .star { position: absolute; width: 2px; height: 2px; background: white; border-radius: 50%; opacity: 0.8; will-change: opacity; }
        .star.bright { width: 3px; height: 3px; opacity: 1; box-shadow: 0 0 4px white; } /* Reduced shadow blur radius for mobile perf */
        
        .constellation-line { 
            position: absolute; 
            height: 1px; 
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent); 
            transform-origin: left center; 
            pointer-events: none; 
        }

        [data-theme="light"] .stars-container, 
        [data-theme="light"] .lines-container { display: none; }
        
        .sky-background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to bottom, #87CEEB 0%, #98D8E8 100%); z-index: -2; display: none; }
        [data-theme="light"] .sky-background { display: block; }
        
        /* OPTIMIZATION: Hardware Accelerated Cloud Animations */
        .cloud { position: absolute; background: white; border-radius: 100px; opacity: 0.8; display: none; will-change: transform; }
        [data-theme="light"] .cloud { display: block; }
        .cloud:before, .cloud:after { content: ''; position: absolute; background: white; border-radius: 100px; }
        
        .cloud1 { width: 100px; height: 40px; top: 20%; left: -150px; animation: float-cloud-1 30s linear infinite; }
        .cloud1:before { width: 50px; height: 50px; top: -25px; left: 10px; }
        .cloud1:after { width: 40px; height: 40px; top: -15px; left: 50px; }
        
        .cloud2 { width: 140px; height: 50px; top: 60%; left: -150px; animation: float-cloud-2 45s linear infinite; animation-delay: -10s; }
        .cloud2:before { width: 70px; height: 70px; top: -35px; left: 20px; }
        .cloud2:after { width: 60px; height: 60px; top: -25px; left: 70px; }
        
        /* OPTIMIZATION: Use TranslateX instead of Left property to avoid Reflows */
        @keyframes float-cloud-1 { from { transform: translateX(0); } to { transform: translateX(calc(100vw + 150px)); } }
        @keyframes float-cloud-2 { from { transform: translateX(0); } to { transform: translateX(calc(100vw + 200px)); } }
        
        /* --- LAYOUT --- */
        .container { 
            position: relative; 
            z-index: 1; 
            width: 100%; 
            max-width: 900px; 
            display: flex;
            flex-direction: column;
            gap: 20px; 
        }
        
        .glass-panel {
            background: var(--surface-color); 
            padding: 30px 40px;
            border-radius: 24px;
            transition: var(--transition);
            /* OPTIMIZATION: Blur is expensive. We keep it, but watch performance on old devices */
            backdrop-filter: blur(10px); 
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* --- POST STYLES --- */
        .post-container { text-align: left; line-height: 1.8; font-size: 1.05rem; }
        .post-container img { max-width: 100%; height: auto; border-radius: 12px; margin: 20px 0; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .post-container h2, .post-container h3 { margin-top: 30px; margin-bottom: 15px; color: var(--primary-color); }
        .post-container p { margin-bottom: 20px; }

        /* --- HEADER PROFILE --- */
        .profile-image { width: 110px; height: 110px; border-radius: 50%; margin: 0 auto 15px; border: 4px solid var(--primary-color); overflow: hidden; display: flex; justify-content: center; align-items: center; background-color: rgba(255,255,255,0.1); }
        .profile-image img { width: 100%; height: 100%; object-fit: cover; }
        h1 { font-size: 2rem; margin-bottom: 6px; font-weight: 700; letter-spacing: -0.5px; text-align: center; }
        .subtitle { color: var(--primary-color); font-weight: 500; font-size: 1.1rem; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; text-align: center; }
        
        .contact-info { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; margin-bottom: 10px; }
        .contact-item { 
            position: relative; display: flex; align-items: center; color: var(--text-secondary); text-decoration: none; padding: 8px 16px; border-radius: 50px; background: rgba(255, 255, 255, 0.05); font-weight: 500; overflow: hidden; transition: transform 0.2s ease, color 0.3s ease; z-index: 1;
        }
        .contact-item .material-icons { font-size: 20px; position: relative; z-index: 2; }
        .contact-item span:not(.material-icons) { margin-left: 8px; position: relative; z-index: 2; }
        .contact-item::before { content: ""; position: absolute; top: 0; left: 0; bottom: 0; right: 0; opacity: 1; transform: scaleX(0); transform-origin: right; transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); z-index: 1; }
        
        .contact-item:nth-child(6n+1)::before { background: var(--logo-1); }
        .contact-item:nth-child(6n+2)::before { background: var(--logo-2); }
        .contact-item:nth-child(6n+3)::before { background: var(--logo-3); }
        
        .theme-toggle { position: absolute; top: 20px; right: 20px; background: rgba(255, 255, 255, 0.1); border: none; color: var(--text-primary); width: 44px; height: 44px; /* Larger touch target */ border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); transition: 0.3s; z-index: 100; }

        @keyframes blogGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .blog-list { width: 100%; }
        
        .blog-row { 
            position: relative;
            display: flex; align-items: center; padding: 15px; 
            background: var(--surface-color); 
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border-radius: 16px; margin-bottom: 20px; text-decoration: none; color: var(--text-primary); border: 1px solid rgba(255, 255, 255, 0.05); overflow: hidden; transition: transform 0.3s ease; z-index: 1;
        }

        .blog-thumb { width: 110px; height: 110px; aspect-ratio: 1 / 1; object-fit: cover; border-radius: 12px; margin-right: 30px; flex-shrink: 0; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 2; position: relative; background: rgba(0,0,0,0.2); }
        .blog-details { margin-left: 10px; display: flex; flex-direction: column; text-align: left; flex-grow: 1; position: relative; justify-content: center; min-height: 80px; z-index: 2; }
        .blog-date { font-size: 0.85rem; color: var(--text-primary); font-weight: 500; letter-spacing: 0.5px; position: absolute; top: 0px; right: 0px; text-transform: uppercase; transition: color 0.3s ease; }
        .blog-title { font-size: 1.4rem; font-weight: 500; margin: 0; padding-right: 90px; transition: color 0.3s ease; }

        .site-footer { font-size: 0.9rem; color: var(--text-secondary); margin-top: auto; text-align: center; }

        /* OPTIMIZATION: HOVER MEDIA QUERY
           Only apply hover effects on devices that have a mouse (pointer: fine). 
           This prevents "sticky" hover states on mobile touch.
        */
        @media (hover: hover) and (pointer: fine) {
            .contact-item:hover { color: white; transform: translateY(-3px); }
            .contact-item:hover::before { transform: scaleX(1); transform-origin: right; }
            .theme-toggle:hover { background: rgba(255, 255, 255, 0.2); transform: rotate(15deg); }
            .blog-row:hover {
                transform: translateY(-3px);
                box-shadow: 0 10px 24px rgba(0, 0, 0, 0.35);
                border-color: rgba(255, 255, 255, 0.4);
                background-image: linear-gradient(135deg, var(--logo-1), var(--logo-2), var(--logo-3), var(--logo-4), var(--logo-5), var(--logo-6));
                background-size: 300% 300%;
                animation: blogGradient 6s ease infinite; 
                color: #ffffff;
            }
        }

        @media (max-width: 600px) { 
            body { padding: 15px 10px; } /* Less padding on edges */
            .container { padding: 0; gap: 15px; }
            .glass-panel { padding: 25px 20px; }
            
            /* Better tap targets for contact info */
            .contact-info { gap: 10px; }
            .contact-item { flex: 1 1 40%; justify-content: center; padding: 10px 12px; font-size: 0.9rem; }
            
            .blog-row { flex-direction: column; align-items: flex-start; text-align: left; padding: 15px; } 
            .blog-thumb { width: 100%; height: 180px; margin-right: 0; margin-bottom: 15px; border-radius: 12px; } 
            .blog-details { margin-left: 0; width: 100%; display: block; min-height: auto; } 
            .blog-title { font-size: 1.2rem; padding-right: 0; margin-bottom: 8px; line-height: 1.3; } 
            .blog-date { position: relative; display: block; margin-bottom: 5px; opacity: 0.7; font-size: 0.8rem; }
        }
    </style>
</head>
<body>

    <button class="theme-toggle" id="themeToggle" aria-label="Toggle Dark Mode"><span class="material-icons">light_mode</span></button>
    
    <!-- Stars Background Layers -->
    <div class="stars-container" id="stars"></div>
    <div class="lines-container" id="lines"></div>
    
    <div class="sky-background"></div>
    <div class="cloud cloud1"></div>
    <div class="cloud cloud2"></div>

    <div class="container">
        
        <!-- MAIN CONTENT -->
        <main>
            {{ content }}
        </main>

        <!-- FOOTER -->
        <footer class="glass-panel site-footer">
            <p>&copy; 2026 Sailing Kiruna. All rights reserved.</p>
        </footer>

    </div>

    <script>
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        const themeIcon = themeToggle.querySelector('.material-icons');
        let starData = []; 
        let mouseHandlerRef = null; 

        function applyTheme(theme) {
            body.setAttribute('data-theme', theme);
            themeIcon.textContent = theme === 'dark' ? 'light_mode' : 'dark_mode';
            
            if (theme === 'dark') { 
                generateStars(); 
            } else { 
                clearStars(); 
            }
        }

        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) { applyTheme(savedTheme); } 
            else { 
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                applyTheme(prefersDark ? 'dark' : 'light'); 
            }
        }

        themeToggle.addEventListener('click', () => {
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            applyTheme(newTheme);
            localStorage.setItem('theme', newTheme);
        });

        function clearStars() {
            const starsContainer = document.getElementById('stars');
            const linesContainer = document.getElementById('lines');
            if (starsContainer) starsContainer.innerHTML = '';
            if (linesContainer) linesContainer.innerHTML = '';
            
            if (mouseHandlerRef) {
                document.removeEventListener('mousemove', mouseHandlerRef);
                mouseHandlerRef = null;
            }
        }

        function generateStars() {
            const starsContainer = document.getElementById('stars');
            const linesContainer = document.getElementById('lines');
            
            clearStars();
            
            if (!starsContainer) return;
            if (body.getAttribute('data-theme') !== 'dark') return;

            // OPTIMIZATION: Reduce star count based on screen size
            // 70 stars for mobile, 150 for desktop
            const isSmallScreen = window.innerWidth < 768;
            const numStars = isSmallScreen ? 70 : 150;
            
            starData = []; 

            const frag = document.createDocumentFragment(); // Use Fragment to minimize reflows

            for (let i = 0; i < numStars; i++) {
                const x = Math.random() * window.innerWidth;
                const y = Math.random() * window.innerHeight;
                
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = x + 'px';
                star.style.top = y + 'px';
                
                // Fewer bright stars with shadows on mobile (shadows are expensive)
                if (Math.random() > (isSmallScreen ? 0.9 : 0.8)) star.classList.add('bright');
                
                frag.appendChild(star);
                starData.push({ x, y });
            }
            starsContainer.appendChild(frag);

            // OPTIMIZATION: Interaction strictly for mouse devices
            if (window.matchMedia('(pointer: fine)').matches) {
                mouseHandlerRef = (e) => {
                    // Use requestAnimationFrame for smoother line drawing
                    requestAnimationFrame(() => {
                        const mouseX = e.clientX; 
                        const mouseY = e.clientY;
                        
                        linesContainer.innerHTML = '';
                        const lineFrag = document.createDocumentFragment();

                        starData.forEach(star => {
                            const distX = mouseX - star.x;
                            const distY = mouseY - star.y;
                            // Avoid Math.sqrt for simple checks (use squared distance) to save CPU
                            const distSq = distX * distX + distY * distY;

                            // 150 * 150 = 22500
                            if (distSq < 22500) {
                                const distance = Math.sqrt(distSq);
                                const line = document.createElement('div');
                                line.className = 'constellation-line';
                                const angle = Math.atan2(distY, distX) * 180 / Math.PI;

                                line.style.left = star.x + 'px';
                                line.style.top = star.y + 'px';
                                line.style.width = distance + 'px'; 
                                line.style.transform = `rotate(${angle}deg)`;
                                line.style.opacity = (1 - distance / 150) * 0.6;
                                
                                lineFrag.appendChild(line);
                            }
                        });
                        linesContainer.appendChild(lineFrag);
                    });
                };
                document.addEventListener('mousemove', mouseHandlerRef);
            }
        }

        initTheme();

        // OPTIMIZATION: Handle Resize Smartly on Mobile
        // Mobile browsers trigger resize when scrolling (URL bar hides/shows).
        // We only want to regenerate stars if the WIDTH changes.
        let lastWidth = window.innerWidth;
        window.addEventListener('resize', () => {
            if (window.innerWidth !== lastWidth) {
                lastWidth = window.innerWidth;
                if (body.getAttribute('data-theme') === 'dark') { 
                    generateStars(); 
                }
            }
        });
    </script>
</body>
</html>
